<button
  command="show-modal"
  commandfor="dialog"
  class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-8 rounded-lg transition-all duration-300 shadow-lg hover:shadow-indigo-600/30"
>
  Create Confession
</button>

<el-dialog>
  <dialog
    id="dialog"
    aria-labelledby="dialog-title"
    class="fixed inset-0 size-auto max-h-none max-w-none overflow-y-auto bg-transparent backdrop:bg-transparent"
  >
    <el-dialog-backdrop
      class="fixed inset-0 bg-black/70 transition-opacity data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in"
    ></el-dialog-backdrop>

    <div
      tabindex="0"
      class="flex min-h-full items-end justify-center p-4 text-center focus:outline-none sm:items-center sm:p-0"
    >
      <el-dialog-panel
        class="relative transform overflow-hidden rounded-xl bg-gradient-to-b from-gray-900 to-indigo-950 border border-indigo-500/20 text-left shadow-2xl transition-all data-closed:translate-y-4 data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in sm:my-8 sm:w-full sm:max-w-lg data-closed:sm:translate-y-0 data-closed:sm:scale-95"
      >
        <form method="POST" id="confessionForm" action="/">
          <input type="hidden" name="form_id" value="confession_form">
          <div class="px-6 pt-6 pb-5">
            <div class="sm:flex sm:items-start">
              <div
                class="mx-auto flex size-12 shrink-0 items-center justify-center rounded-full bg-indigo-500/20 sm:mx-0 sm:size-10"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  class="size-6 text-indigo-400"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"
                  ></path>
                </svg>
              </div>
              <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                <h3 id="dialog-title" class="text-xl font-semibold text-white">
                  Share Your Confession
                </h3>
                <div class="mt-2">
                  <p class="text-indigo-200">
                    Express your feelings anonymously. Your confession will be
                    shared with the world while keeping your identity secret.
                  </p>
                </div>
              </div>
            </div>

            <div class="mt-6 space-y-4">
              <div>
                <label
                  for="modal-name"
                  class="block text-indigo-200 font-medium mb-2 text-sm"
                  >Your Name (optional)</label
                >
                <input
                  type="text"
                  id="modal-name"
                  name="name"
                  class="w-full bg-white/5 border border-indigo-300/20 rounded-lg px-4 py-3 text-white placeholder-indigo-300/50 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  placeholder="Anonymous"
                />
              </div>

              <div>
                <label
                  for="modal-to"
                  class="block text-indigo-200 font-medium mb-2 text-sm"
                  >To</label
                >
                <input
                  type="text"
                  id="modal-to"
                  name="to"
                  class="w-full bg-white/5 border border-indigo-300/20 rounded-lg px-4 py-3 text-white placeholder-indigo-300/50 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  placeholder="Someone special"
                  required
                />
              </div>

              <div>
                <label
                  for="modal-message"
                  class="block text-indigo-200 font-medium mb-2 text-sm"
                  >Your Message</label
                >
                <textarea
                  id="modal-message"
                  name="message"
                  rows="4"
                  class="w-full bg-white/5 border border-indigo-300/20 rounded-lg px-4 py-3 text-white placeholder-indigo-300/50 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  placeholder="Share your thoughts..."
                  required></textarea>
              </div>
            </div>
          </div>

          <div
            class="border-t border-indigo-500/10 px-6 py-4 flex flex-col-reverse sm:flex-row-reverse gap-3 sm:gap-2"
          >
            <button
              type="submit"
              class="inline-flex w-full justify-center rounded-lg bg-indigo-600 px-5 py-2.5 text-sm font-medium text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 transition-all duration-200 sm:ml-3 sm:w-auto"
            >
              Send Confession
            </button>
            <button
              type="button"
              command="close"
              commandfor="dialog"
              class="inline-flex w-full justify-center rounded-lg bg-white/5 backdrop-blur-sm px-5 py-2.5 text-sm font-medium text-indigo-200 hover:bg-white/10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 transition-all duration-200 sm:w-auto"
            >
              Cancel
            </button>
          </div>
        </form>
      </el-dialog-panel>
    </div>
  </dialog>
</el-dialog>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const dialog = document.getElementById("dialog");
    const form = document.getElementById("confessionForm");

    if (form && dialog) {
      form.addEventListener("submit", (e) => {
        // Prevent default form submission
        e.preventDefault();
        
        // Get form data
        const formData = new FormData(form);
        
        // Submit form via fetch API
        fetch('/', {
          method: 'POST',
          body: formData
        })
        .then(response => {
          // Close dialog after submission
          dialog.close();
          
          // Reload the page with a timestamp to prevent caching
          window.location.href = '/?t=' + new Date().getTime();
        })
        .catch(error => {
          console.error('Error submitting form:', error);
        });
      });
    }
  });
</script>