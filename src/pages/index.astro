---
import Layout from "../layouts/Layout.astro";
import CardConfess from "../components/CardConfess.astro";
import RencentCard from "../components/RencentCard.astro";
import Modal from "../components/Modal.astro";

import { db, Confess } from "astro:db";

if (Astro.request.method === "POST") {
  const formData = await Astro.request.formData();
  const name = formData.get("name") || "Anonymous";
  const to = formData.get("to");
  const message = formData.get("message");
  if (
    typeof name === "string" &&
    typeof to === "string" &&
    typeof message === "string"
  ) {
    await db.insert(Confess).values({ name, to, message });
  }
  return Astro.redirect("/");
}
---

<Layout>
  <!-- Hero Section -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-24">
    <div class="text-center">
      <h1 class="text-4xl md:text-6xl font-bold text-white mb-6 tracking-tight">
        Secret <span class="text-indigo-400">Message</span>
      </h1>
      <p class="text-xl md:text-2xl text-indigo-200 max-w-3xl mx-auto mb-10">
        Share your thoughts, feelings, and confessions anonymously with the
        world.
      </p>
      <div class="mt-8">
        <Modal />
      </div>
    </div>
  </div>

  <!-- Recent Confessions Section -->
  <div>
    <h2 class="text-2xl md:text-3xl font-bold text-white mb-8 text-center">
      Recent Confessions
    </h2>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <RencentCard />
    </div>
  </div>

  <!--  Confessions Section -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">
    <h2 class="text-2xl md:text-3xl font-bold text-white mb-8 text-center">
      Many people have confessed
    </h2>

    <div class="bg-white/5 backdrop-blur-sm rounded-xl p-6 md:p-8">
      <CardConfess />
    </div>
  </div>

  <!-- Footer -->
  <footer
    class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-indigo-300/60"
  >
    <p>Â© 2025 Secret Message | Share your thoughts anonymously</p>
  </footer>
</Layout>
